/* Mermaid diagram styling - Improved sizing and layout */
.mermaid {
  display: flex !important;
  justify-content: center !important;
  align-items: center !important;
  width: 100% !important;
  max-width: 900px !important;
  margin: 30px auto !important;
  padding: 20px !important;
  box-sizing: border-box !important;
}

.mermaid svg {
  font-family: 'LINE Seed JP', 'Helvetica Neue', 'Arial', sans-serif !important;
  max-width: 100% !important;
  max-height: 500px !important;
  width: auto !important;
  height: auto !important;
  display: block !important;
  margin: 0 auto !important;
}

/* h2があるスライドでのMermaid調整 */
section:has(h2) .mermaid {
  margin-top: 40px !important;
  max-height: 400px !important;
}

/* レスポンシブ対応 */
@media (max-width: 1280px) {
  .mermaid {
    max-width: 80% !important;
    padding: 15px !important;
  }
  
  .mermaid svg {
    max-height: 400px !important;
  }
}

/* Node styling */
div#\:\$p svg .node rect,
div#\:\$p svg .node circle,
div#\:\$p svg .node ellipse,
div#\:\$p svg .node polygon,
section svg .node rect,
section svg .node circle,
section svg .node ellipse,
section svg .node polygon,
svg .node rect,
svg .node circle,
svg .node ellipse,
svg .node polygon {
  fill: var(--mermaid-node-bg) !important;
  stroke: var(--mermaid-node-border) !important;
  stroke-width: 2px !important;
  rx: 6px !important;
  ry: 6px !important;
}

/* Text styling */
div#\:\$p svg .nodeLabel,
div#\:\$p svg .node .label,
div#\:\$p svg text,
section svg .nodeLabel,
section svg .node .label,
section svg text,
svg .nodeLabel,
svg .node .label,
svg text {
  fill: var(--mermaid-node-text) !important;
  color: var(--mermaid-node-text) !important;
  font-family: 'LINE Seed JP', 'Helvetica Neue', 'Arial', sans-serif !important;
  font-size: 14px !important;
  font-weight: 600 !important;
  text-anchor: middle !important;
  dominant-baseline: central !important;
}

/* Foreign object styling for HTML labels */
div#\:\$p svg .node .label foreignObject div,
div#\:\$p svg .nodeLabel foreignObject div,
section svg .node .label foreignObject div,
section svg .nodeLabel foreignObject div,
svg .node .label foreignObject div,
svg .nodeLabel foreignObject div {
  color: var(--mermaid-node-text) !important;
  font-family: 'LINE Seed JP', 'Helvetica Neue', 'Arial', sans-serif !important;
  font-size: 12px !important;
  font-weight: 600 !important;
  text-align: center !important;
  padding: 2px 6px !important;
  display: block !important;
  height: auto !important;
  width: auto !important;
  box-sizing: border-box !important;
  line-height: 1.2 !important;
  white-space: nowrap !important;
}

/* Mermaid text styling - Fixed for proper text visibility */
div#\:\$p>svg>foreignObject>section .mermaid text,
div#\:\$p>svg>foreignObject>section .mermaid .nodeLabel,
div#\:\$p>svg>foreignObject>section .mermaid .label,
div#\:\$p>svg>foreignObject>section .mermaid tspan,
div#\:\$p>svg>foreignObject>section .mermaid .edgeLabel,
.mermaid text,
.mermaid .nodeLabel,
.mermaid .label,
.mermaid tspan,
.mermaid .edgeLabel {
  fill: #ffffff !important;
  color: #ffffff !important;
  font-family: 'LINE Seed JP', 'Helvetica Neue', 'Arial', sans-serif !important;
  font-size: 12px !important;
  font-weight: 600 !important;
  opacity: 1 !important;
  visibility: visible !important;
  stroke: none !important;
}

/* Override any default text colors */
div#\:\$p>svg>foreignObject>section .mermaid svg text[fill]:not([fill="#ffffff"]),
.mermaid svg text[fill]:not([fill="#ffffff"]) {
  fill: #ffffff !important;
}

/* Ensure node labels are visible */
div#\:\$p>svg>foreignObject>section .mermaid .node .label,
div#\:\$p>svg>foreignObject>section .mermaid .node text,
.mermaid .node .label,
.mermaid .node text {
  fill: #ffffff !important;
  color: #ffffff !important;
}

/* Edge and arrow styling */
div#\:\$p svg .edgePath .path,
section svg .edgePath .path,
svg .edgePath .path {
  stroke: var(--mermaid-edge-color) !important;
  stroke-width: 2px !important;
}

div#\:\$p svg .arrowheadPath,
section svg .arrowheadPath,
svg .arrowheadPath {
  fill: var(--mermaid-edge-color) !important;
  stroke: var(--mermaid-edge-color) !important;
}

/* Edge labels styling */
div#\:\$p svg .edgeLabel,
section svg .edgeLabel,
svg .edgeLabel {
  background-color: var(--mermaid-edge-label-bg) !important;
  color: var(--mermaid-edge-label-text) !important;
  font-family: 'LINE Seed JP', 'Helvetica Neue', 'Arial', sans-serif !important;
  font-size: 12px !important;
  padding: 2px 6px !important;
  border-radius: 4px !important;
}

/* Ensure all text elements are visible */
div#\:\$p svg tspan,
section svg tspan,
svg tspan {
  fill: var(--mermaid-node-text) !important;
  font-family: 'LINE Seed JP', 'Helvetica Neue', 'Arial', sans-serif !important;
}